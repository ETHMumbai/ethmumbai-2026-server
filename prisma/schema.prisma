generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =======================
// Tickets Table
// =======================
model Ticket {
  id       Int      @id @default(autoincrement())
  title    String   @unique
  type     String   // "earlybird" or "standard"
  price    Float
  quantity Int
  carts    Cart[]    // back-relation to Cart
  orders   Order[]   // back-relation to Order
}

// =======================
// Cart Table
// =======================
model Cart {
  id           String        @id @default(cuid())
  ticketId     Int
  quantity     Int
  participants Participant[]
  order        Order?        // optional link to Order
  ticket       Ticket        @relation(fields: [ticketId], references: [id])
  createdAt    DateTime      @default(now())
}

// =======================
// Participant Table
// =======================
model Participant {
  id       Int      @id @default(autoincrement())
  cartId   String
  name     String
  email    String?
  isBuyer  Boolean  @default(false) // marks the buyer
  phone    String                    // buyer contact
  cart     Cart    @relation(fields: [cartId], references: [id])
}

// =======================
// Order Table (new)
// =======================
model Order {
  id          Int          @id @default(autoincrement())
  cartId      String       @unique
  ticketId    Int
  amount      Float
  currency    CurrencyType @default(INR)
  status      String       @default("created") // created, attempted, paid, failed
  paymentType PaymentType
  payment     Payment?

  cart        Cart         @relation(fields: [cartId], references: [id])
  ticket      Ticket       @relation(fields: [ticketId], references: [id])
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}


// =======================
// Payment Table (new)
// =======================
model Payment {
  id               Int          @id @default(autoincrement())
  orderId          Int          @unique
  vendor           PaymentType  // RAZORPAY | DAIMO
  vendorPaymentId  String?      // Razorpay: payment_id | Daimo: payId
  vendorOrderId    String?      // Razorpay: order_id | Daimo: optional
  vendorTxHash     String?      // Daimo: tx hash
  amount           Float
  currency         String       // e.g. "INR", "USDC", "USD"
  status           String       @default("created")
  verified         Boolean      @default(false)
  rawPayload       Json?        // ðŸ’¥ Store full response from vendor API
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt

  order            Order        @relation(fields: [orderId], references: [id])
}



// =======================
// Payment Type Enum
// =======================
enum PaymentType {
  RAZORPAY
  DAIMO
}


// =======================
// Currency Type Enum
// =======================
enum CurrencyType {
  INR
  CRYPTO
}